---
import { Icon } from 'astro-icon/components';

export interface Props {
  currentPage: number;
  totalPages: number;
  prevUrl?: string;
  nextUrl?: string;
  baseUrl?: string;
}

const { 
  currentPage, 
  totalPages, 
  prevUrl, 
  nextUrl,
  baseUrl = '/blog/page'
} = Astro.props;

// Define a type for page indicators (number or ellipsis)
type PageIndicator = number | 'ellipsis';

// Generate page numbers to display
function generatePagination(current: number, total: number): PageIndicator[] {
  // Always show first and last page
  // Show 2 pages before and after current page
  // Use ellipsis for gaps
  
  const pages: PageIndicator[] = [];
  
  if (total <= 7) {
    // If 7 or fewer pages, show all
    for (let i = 1; i <= total; i++) {
      pages.push(i);
    }
  } else {
    // Always add first page
    pages.push(1);
    
    // Add ellipsis if needed
    if (current > 3) {
      pages.push('ellipsis');
    }
    
    // Add pages around current
    const start = Math.max(2, current - 1);
    const end = Math.min(total - 1, current + 1);
    
    for (let i = start; i <= end; i++) {
      pages.push(i);
    }
    
    // Add ellipsis if needed
    if (current < total - 2) {
      pages.push('ellipsis');
    }
    
    // Always add last page
    if (total > 1) {
      pages.push(total);
    }
  }
  
  return pages;
}

const pages = generatePagination(currentPage, totalPages);
---

{totalPages > 1 && (
  <nav aria-label="Pagination" class="mt-8 flex justify-center">
    <ul class="flex items-center gap-1">
      <!-- Previous page -->
      <li>
        {prevUrl ? (
          <a 
            href={prevUrl} 
            class="btn-outline flex h-10 w-10 items-center justify-center rounded-md p-0"
            aria-label="Previous page"
          >
            <Icon name="tabler:chevron-left" class="h-5 w-5" />
          </a>
        ) : (
          <span 
            class="btn-outline flex h-10 w-10 items-center justify-center rounded-md p-0 opacity-50 cursor-not-allowed"
            aria-disabled="true"
          >
            <Icon name="tabler:chevron-left" class="h-5 w-5" />
          </span>
        )}
      </li>
      
      <!-- Page numbers -->
      {pages.map((page) => (
        <li>
          {page === 'ellipsis' ? (
            <span class="flex h-10 w-10 items-center justify-center text-muted-foreground">
              &hellip;
            </span>
          ) : page === currentPage ? (
            <span 
              class="flex h-10 w-10 items-center justify-center rounded-md bg-primary text-primary-foreground"
              aria-current="page"
            >
              {page}
            </span>
          ) : (
            <a 
              href={page === 1 ? '/blog' : `${baseUrl}/${page}`}
              class="flex h-10 w-10 items-center justify-center rounded-md hover:bg-accent hover:text-accent-foreground"
            >
              {page}
            </a>
          )}
        </li>
      ))}
      
      <!-- Next page -->
      <li>
        {nextUrl ? (
          <a 
            href={nextUrl} 
            class="btn-outline flex h-10 w-10 items-center justify-center rounded-md p-0"
            aria-label="Next page"
          >
            <Icon name="tabler:chevron-right" class="h-5 w-5" />
          </a>
        ) : (
          <span 
            class="btn-outline flex h-10 w-10 items-center justify-center rounded-md p-0 opacity-50 cursor-not-allowed"
            aria-disabled="true"
          >
            <Icon name="tabler:chevron-right" class="h-5 w-5" />
          </span>
        )}
      </li>
    </ul>
  </nav>
)}
